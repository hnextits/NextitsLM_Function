<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïù∏ÌÑ∞ÎûôÌã∞Î∏å ÎßàÏù∏ÎìúÎßµ</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Malgun Gothic', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            overflow: hidden;
        }
        
        #mindmap-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: #555;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: translateY(-1px);
        }
        
        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 14px 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            max-width: 280px;
        }
        
        .info-panel h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .info-panel p {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
        }
        
        .node {
            cursor: pointer;
        }
        
        .node circle {
            stroke-width: 2.5px;
            transition: all 0.3s;
        }
        
        .node:hover circle {
            stroke-width: 4px;
            filter: brightness(1.1);
        }
        
        .node text {
            font-size: 16px;
            font-weight: 500;
            pointer-events: none;
            fill: #333;
        }
        
        .link {
            fill: none;
            stroke-width: 2.5px;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .link:hover {
            opacity: 1;
            stroke-width: 3px;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 300px;
            z-index: 2000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .tooltip.show {
            opacity: 1;
        }
        
        .tooltip-title {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 13px;
        }
        
        .tooltip-content {
            line-height: 1.5;
            color: #ddd;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .legend-title {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
            font-size: 12px;
            color: #666;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="mindmap-container"></div>
    
    <div class="controls">
        <button class="control-btn" onclick="resetView()">üîÑ Ï¥àÍ∏∞Ìôî</button>
        <button class="control-btn" onclick="expandAll()">‚ûï Ï†ÑÏ≤¥ ÌéºÏπòÍ∏∞</button>
        <button class="control-btn" onclick="collapseAll()">‚ûñ Ï†ÑÏ≤¥ Ï†ëÍ∏∞</button>
    </div>
    
    <div class="info-panel">
        <h3>üí° ÏÇ¨Ïö© Î∞©Î≤ï</h3>
        <p>‚Ä¢ ÎìúÎûòÍ∑∏: ÌôîÎ©¥ Ïù¥Îèô<br>‚Ä¢ Ïä§ÌÅ¨Î°§: ÌôïÎåÄ/Ï∂ïÏÜå<br>‚Ä¢ ÎÖ∏Îìú ÌÅ¥Î¶≠: ÌïòÏúÑ Ìï≠Î™© ÌéºÏπòÍ∏∞/Ï†ëÍ∏∞<br>‚Ä¢ ÎÖ∏Îìú Ìò∏Î≤Ñ: ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î≥¥Í∏∞</p>
    </div>
    
    <div class="legend">
        <div class="legend-title">Î≤îÎ°Ä</div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Ï£ºÏ†ú (Topic)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #7B68EE;"></div>
            <span>ÌïòÏúÑ Ï£ºÏ†ú (Subtopic)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #50C878;"></div>
            <span>ÏÑ∏Î∂Ä ÏÇ¨Ìï≠ (Detail)</span>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        const mindmapData = MINDMAP_DATA_PLACEHOLDER;
        
        // ÏÉâÏÉÅ Ïä§ÌÇ¥ - ÍπîÎÅîÌïòÍ≥† Ïã¨ÌîåÌïú ÏÉâÏÉÅ
        const colors = {
            root: '#2C3E50',
            topic: '#4A90E2',
            subtopic: '#7B68EE',
            detail: '#50C878'
        };
        
        // SVG ÏÑ§Ï†ï
        const width = window.innerWidth;
        const height = window.innerHeight;
        
        const svg = d3.select('#mindmap-container')
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // Ï§å Í∏∞Îä•
        const g = svg.append('g');
        
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on('zoom', (event) => {
                g.attr('transform', event.transform);
            });
        
        svg.call(zoom);
        
        // Îç∞Ïù¥ÌÑ∞ Î≥ÄÌôò
        function transformData(data) {
            const root = {
                name: 'Î¨∏ÏÑú ÎßàÏù∏ÎìúÎßµ',
                type: 'root',
                children: []
            };
            
            if (data && data.topics) {
                data.topics.forEach(topic => {
                    const topicNode = {
                        name: topic.name,
                        type: 'topic',
                        summary: topic.summary,
                        citations: topic.citations,
                        children: []
                    };
                    
                    if (topic.subtopics && topic.subtopics.length > 0) {
                        topic.subtopics.forEach(subtopic => {
                            const subtopicNode = {
                                name: subtopic.name,
                                type: 'subtopic',
                                citations: subtopic.citations,
                                children: []
                            };
                            
                            if (subtopic.details && subtopic.details.length > 0) {
                                subtopic.details.forEach(detail => {
                                    subtopicNode.children.push({
                                        name: detail.text || detail.name || detail,  // text ÌïÑÎìú Ïö∞ÏÑ† ÏÇ¨Ïö©
                                        type: 'detail',
                                        importance: detail.importance,
                                        citations: detail.citations
                                    });
                                });
                            }
                            
                            topicNode.children.push(subtopicNode);
                        });
                    }
                    
                    root.children.push(topicNode);
                });
            }
            
            return root;
        }
        
        // Ìä∏Î¶¨ Î†àÏù¥ÏïÑÏõÉ - Ï¢å‚ÜíÏö∞ Î∞©Ìñ• (ÎÖ∏Îìú Í∞ÑÍ≤© Îã®Ï∂ï)
        const treeLayout = d3.tree()
            .size([height - 100, width - 600])
            .nodeSize([60, 150]);  // ÏàòÏßÅ Í∞ÑÍ≤© 60px, ÏàòÌèâ Í∞ÑÍ≤© 150pxÎ°ú Îã®Ï∂ï
        
        const rootData = transformData(mindmapData);
        const root = d3.hierarchy(rootData);
        
        root.descendants().forEach(d => {
            d._children = d.children;
            if (d.depth > 2) {  // depth 2(Subtopic)ÍπåÏßÄ ÌëúÏãú, depth 3(Detail) Ïù¥ÏÉÅÎßå Ïà®ÍπÄ
                d.children = null;
            }
        });
        
        treeLayout(root);
        
        // ÎßÅÌÅ¨ Í∑∏Î¶¨Í∏∞
        const linkGroup = g.append('g').attr('class', 'links');
        const nodeGroup = g.append('g').attr('class', 'nodes');
        
        function update(source) {
            treeLayout(root);
            
            // ÎßÅÌÅ¨ ÏóÖÎç∞Ïù¥Ìä∏
            const links = linkGroup.selectAll('.link')
                .data(root.links(), d => d.target.data.name);
            
            links.exit().remove();
            
            const linkEnter = links.enter()
                .append('path')
                .attr('class', 'link')
                .attr('stroke', d => colors[d.target.data.type] || '#999');
            
            linkEnter.merge(links)
                .attr('d', d3.linkHorizontal()
                    .x(d => d.y)
                    .y(d => d.x));
            
            // ÎÖ∏Îìú ÏóÖÎç∞Ïù¥Ìä∏
            const nodes = nodeGroup.selectAll('.node')
                .data(root.descendants(), d => d.data.name);
            
            nodes.exit().remove();
            
            const nodeEnter = nodes.enter()
                .append('g')
                .attr('class', 'node')
                .on('click', (event, d) => {
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                    } else if (d._children) {
                        d.children = d._children;
                        d._children = null;
                    }
                    update(d);
                })
                .on('mouseover', (event, d) => showTooltip(event, d))
                .on('mouseout', hideTooltip);
            
            nodeEnter.append('circle')
                .attr('r', d => {
                    // depthÎ≥Ñ Ïõê ÌÅ¨Í∏∞ Ï¶ùÍ∞Ä
                    if (d.depth === 0) return 18;      // Root: 18px
                    if (d.depth === 1) return 14;      // Topic: 14px
                    if (d.depth === 2) return 10;      // Subtopic: 10px
                    return 8;                           // Detail: 8px
                })
                .attr('fill', d => colors[d.data.type] || '#999')
                .attr('stroke', '#fff')
                .attr('stroke-width', 3);
            
            nodeEnter.append('text')
                .attr('dy', '0.31em')
                .attr('x', d => d.children || d._children ? -20 : 20)
                .attr('text-anchor', d => d.children || d._children ? 'end' : 'start')
                .text(d => {
                    const maxLength = 30;  // ÏµúÎåÄ Í∏∏Ïù¥ Ï¶ùÍ∞Ä
                    return d.data.name.length > maxLength 
                        ? d.data.name.substring(0, maxLength) + '...' 
                        : d.data.name;
                })
                .style('fill', '#333')
                .style('font-size', d => {
                    // depthÎ≥Ñ Í∏ÄÏî® ÌÅ¨Í∏∞ Ï¶ùÍ∞Ä
                    if (d.depth === 0) return '18px';  // Root: 18px
                    if (d.depth === 1) return '16px';  // Topic: 16px
                    if (d.depth === 2) return '14px';  // Subtopic: 14px
                    return '13px';                      // Detail: 13px
                })
                .style('font-weight', d => d.depth === 0 ? '700' : d.depth === 1 ? '600' : '500');
            
            nodeEnter.merge(nodes)
                .attr('transform', d => `translate(${d.y},${d.x})`);
        }
        
        // Ìà¥ÌåÅ
        function showTooltip(event, d) {
            const tooltip = document.getElementById('tooltip');
            let content = `<div class="tooltip-title">${d.data.name}</div>`;
            
            if (d.data.summary) {
                content += `<div class="tooltip-content">${d.data.summary}</div>`;
            }
            if (d.data.citations) {
                content += `<div class="tooltip-content" style="margin-top: 6px; color: #aaa;">üìé ${d.data.citations}</div>`;
            }
            
            tooltip.innerHTML = content;
            tooltip.style.left = event.pageX + 15 + 'px';
            tooltip.style.top = event.pageY + 15 + 'px';
            tooltip.classList.add('show');
        }
        
        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }
        
        // Ïª®Ìä∏Î°§ Ìï®Ïàò (Î≤ÑÌäº Í∏∞Îä• Í∞úÏÑ†)
        function resetView() {
            // Ï¥àÍ∏∞ ÏúÑÏπòÎ°ú Î∂ÄÎìúÎüΩÍ≤å Ïù¥Îèô
            svg.transition()
                .duration(750)
                .call(zoom.transform, d3.zoomIdentity.translate(100, height / 2).scale(1));
        }
        
        function expandAll() {
            // Î™®Îì† ÎÖ∏Îìú ÌéºÏπòÍ∏∞
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                }
            });
            update(root);
            // ÌéºÏπú ÌõÑ ÏûêÎèôÏúºÎ°ú Ï†ÅÏ†àÌïú ÏúÑÏπòÎ°ú Ïù¥Îèô
            setTimeout(() => {
                svg.transition()
                    .duration(500)
                    .call(zoom.transform, d3.zoomIdentity.translate(100, height / 2).scale(0.8));
            }, 100);
        }
        
        function collapseAll() {
            // depth 2(Subtopic)ÍπåÏßÄÎßå ÌëúÏãú, ÎÇòÎ®∏ÏßÄ Ï†ëÍ∏∞
            root.descendants().forEach(d => {
                if (d.depth > 2 && d.children) {
                    d._children = d.children;
                    d.children = null;
                }
            });
            update(root);
            // Ï†ëÏùÄ ÌõÑ ÏûêÎèôÏúºÎ°ú Ï†ÅÏ†àÌïú ÏúÑÏπòÎ°ú Ïù¥Îèô
            setTimeout(() => {
                svg.transition()
                    .duration(500)
                    .call(zoom.transform, d3.zoomIdentity.translate(100, height / 2).scale(1));
            }, 100);
        }
        
        // Ï¥àÍ∏∞ Î†åÎçîÎßÅ - Ï¢åÏ∏°ÏóêÏÑú ÏãúÏûë (ÏúÑÏπò Ï°∞Ï†ï)
        g.attr('transform', `translate(100,${height / 2})`);
        update(root);
        
        // Ï¥àÍ∏∞ Ï§å Î†àÎ≤® ÏÑ§Ï†ï (ÏïΩÍ∞Ñ Ï∂ïÏÜåÌïòÏó¨ Ï†ÑÏ≤¥ Î≥¥Í∏∞ Ìé∏ÌïòÍ≤å)
        setTimeout(() => {
            svg.call(zoom.transform, d3.zoomIdentity.translate(100, height / 2).scale(0.9));
        }, 100);
    </script>
</body>
</html>
